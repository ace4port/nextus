"use strict";(self.webpackChunkyuewu_dev=self.webpackChunkyuewu_dev||[]).push([[5162],{93016:(H,f,t)=>{t.d(f,{Z:()=>C});var e=t(53547),l=t(84714);function c(){return e.createElement(l.Z.Root,null,e.createElement(l.Z.Headers,null),e.createElement(l.Z.Body,null))}const C=c},84714:(H,f,t)=>{t.d(f,{Z:()=>me});var e=t(53547),l=t(45697),c=t.n(l),C=t(69554),B=t(22072),w=t(54863),ee=t(45421),de=t(11047),E=t(19270),A=t(77197),U=t(65833),te=t(33709),D=t(54580),ce=t(63237),ne=t(75515),h=t(26031),ae=t(36213),ue=t(92155),V=t(39645);const G=o=>o.reduce((i,d)=>{const y=d.split(".")[0];return i[y]||(i[y]=[]),i[y].push(d),i},{}),S=(0,w.default)(ee.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:o})=>o.colors.neutral100};
  }

  thead th span {
    color: ${({theme:o})=>o.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:o})=>o.spaces[3]};
    padding-block-end: ${({theme:o})=>o.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    // Add padding to the start of the first column to avoid the checkbox appearing
    // too close to the edge of the table
    padding-inline-start: ${({theme:o})=>o.spaces[2]};
  }
`,j=o=>{const i=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return o&&(i.push({id:"app.utils.publish",defaultMessage:"Publish"}),i.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),i},R=o=>{const i=["entry.create","entry.update","entry.delete"];return o&&i.push("entry.publish","entry.unpublish"),{entry:i,media:["media.create","media.update","media.delete"]}},Q=e.createContext(),se=({children:o})=>{const{formatMessage:i}=(0,B.Z)(),{collectionTypes:d,isLoading:y}=(0,V.G)(),P=e.useMemo(()=>d.some(k=>k.options.draftAndPublish===!0),[d]),I=i({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(Q.Provider,{value:{isDraftAndPublish:P}},e.createElement(de.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(E.Q,{"aria-hidden":!0},I),y&&e.createElement(A.a,null,i({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(S,{"aria-label":I},o)))};se.propTypes={children:c().oneOfType([c().arrayOf(c().node),c().node]).isRequired};const J=({getHeaders:o=j})=>{const{isDraftAndPublish:i}=e.useContext(Q),{formatMessage:d}=(0,B.Z)(),y=o(i);return e.createElement(U.S,null,e.createElement(te.Z,null,e.createElement(D.g,null,e.createElement(ce.T,null,d({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),y.map(P=>["app.utils.publish","app.utils.unpublish"].includes(P.id)?e.createElement(D.g,{key:P.id,title:d({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(ne.Z,{variant:"sigma",textColor:"neutral600"},d(P))):e.createElement(D.g,{key:P.id},e.createElement(ne.Z,{variant:"sigma",textColor:"neutral600"},d(P))))))};J.defaultProps={getHeaders:j},J.propTypes={getHeaders:c().func};const Y=({providedEvents:o})=>{const{isDraftAndPublish:i}=e.useContext(Q),d=o||R(i),{values:y,handleChange:P}=(0,C.useFormikContext)(),I="events",k=y.events,z=[],N=G(k),b=({target:{name:v,value:g}})=>{let T=new Set(k);g?T.add(v):T.delete(v),P({target:{name:I,value:Array.from(T)}})},x=({target:{name:v,value:g}})=>{let T=new Set(k);g?d[v].forEach(K=>{z.includes(K)||T.add(K)}):d[v].forEach(K=>T.delete(K)),P({target:{name:I,value:Array.from(T)}})};return e.createElement(h.X,null,Object.entries(d).map(([v,g])=>e.createElement(X,{disabledEvents:z,key:v,name:v,events:g,inputValue:N[v],handleSelect:b,handleSelectAll:x})))};Y.defaultProps={providedEvents:null},Y.propTypes={providedEvents:c().object};const ge=o=>o.replace(/-/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "),X=({disabledEvents:o,name:i,events:d,inputValue:y,handleSelect:P,handleSelectAll:I})=>{const{formatMessage:k}=(0,B.Z)(),z=d.filter(g=>!o.includes(g)),N=y.length>0,b=y.length===z.length,x=({target:{name:g}})=>{I({target:{name:g,value:!b}})},v=5;return e.createElement(te.Z,null,e.createElement(D.f,null,e.createElement(ae.X,{indeterminate:N&&!b,"aria-label":k({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:i,onChange:x,value:b},ge(i))),d.map(g=>e.createElement(D.f,{key:g},e.createElement(ue.C,{disabled:o.includes(g),"aria-label":g,name:g,value:y.includes(g),onValueChange:T=>P({target:{name:g,value:T}})}))),d.length<v&&e.createElement(D.f,{colSpan:`${v-d.length}`}))};X.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},X.propTypes={disabledEvents:c().array,events:c().array,inputValue:c().array,handleSelect:c().func,handleSelectAll:c().func,name:c().string.isRequired};const me={Root:se,Headers:J,Body:Y,EventRow:X}},41128:(H,f,t)=>{t.d(f,{Z:()=>Pe});var e=t(53547),l=t(22551),c=t(185),C=t(88767),B=t(16550),w=t(39645),ee=t(70885),de=t(45697),E=t.n(de),A=t(69554),U=t(22072),te=t(90321),D=t(85018),ce=t(67109),ne=t(53979),h=t(11047),ae=t(29728),ue=t(49066),V=t(41580),G=t(11276),S=t(67819),j=t(16364),R=t(87561);const Q=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,se=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,J=({formatMessage:n})=>R.Ry().shape({name:R.Z_().required(n({id:"Settings.webhooks.validation.name",defaultMessage:"Name is required"})).matches(Q,l.translatedErrors.regex),url:R.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(se,n({id:l.translatedErrors.regex,defaultMessage:"The value does not match the regex"})),headers:R.Vo(a=>{let s=R.IX();if(a.length===1){const{key:u,value:p}=a[0];if(!u&&!p)return s}return s.of(R.Ry().shape({key:R.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:R.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:R.IX()});var Y=t(96315),ge=t(19270),X=t(39785),me=t(29178),o=t(90608);const i=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],d=({name:n,onChange:a,value:s,...u})=>{const{values:{headers:p}}=(0,A.useFormikContext)(),[Z,m]=(0,e.useState)(i);(0,e.useEffect)(()=>{m(i.filter(r=>!p?.some($=>$.key!==s&&$.key===r)))},[p,s]);const F=r=>{a({target:{name:n,value:r}})},_=r=>{m($=>[...$,r]),F(r)};return e.createElement(me.XU,{...u,onClear:()=>F(""),onChange:F,onCreateOption:_,placeholder:"",value:s},Z.map(r=>e.createElement(o.O,{value:r,key:r},r)))};d.defaultProps={value:void 0},d.propTypes={name:E().string.isRequired,onChange:E().func.isRequired,value:E().string};const y=d,I=()=>{const{formatMessage:n}=(0,U.Z)(),{values:a,errors:s}=(0,A.useFormikContext)();return e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(ge.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(V.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(A.FieldArray,{validateOnChange:!1,name:"headers",render:({push:u,remove:p})=>e.createElement(G.r,{gap:4},a.headers.map((Z,m)=>e.createElement(e.Fragment,{key:`${m}.${Z.key}`},e.createElement(S.P,{col:6},e.createElement(A.Field,{as:y,name:`headers.${m}.key`,"aria-label":`row ${m+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:s.headers?.[m]?.key&&s.headers[m].key})),e.createElement(S.P,{col:6},e.createElement(h.k,{alignItems:"flex-end"},e.createElement(V.x,{style:{flex:1}},e.createElement(A.Field,{as:j.o,name:`headers.${m}.value`,"aria-label":`row ${m+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:s.headers?.[m]?.value&&s.headers[m].value})),e.createElement(h.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:s.headers?.[m]?.value?0:5},e.createElement(l.RemoveRoundedButton,{disabled:a.headers.length===1,onClick:()=>p(m),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:m+1})})))))),e.createElement(S.P,{col:12},e.createElement(X.A,{type:"button",onClick:()=>{u({key:"",value:""})},startIcon:e.createElement(Y.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var k=t(54863),z=t(86647),N=t(70968),b=t(75515);const x=k.default.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),v=({isPending:n,statusCode:a})=>{const{formatMessage:s}=(0,U.Z)();return n?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(x,{as:z.Z}),e.createElement(b.Z,null,s({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(x,{as:D.Z,color:"success700"}),e.createElement(b.Z,null,s({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(x,{as:N.Z,color:"danger700"}),e.createElement(b.Z,null,s({id:"Settings.error",defaultMessage:"error"})," ",a)):null};v.propTypes={isPending:E().bool.isRequired,statusCode:E().number},v.defaultProps={statusCode:void 0};const g=({statusCode:n,message:a})=>{const{formatMessage:s}=(0,U.Z)();return n>=200&&n<300?e.createElement(h.k,{justifyContent:"flex-end"},e.createElement(b.Z,{textColor:"neutral600",ellipsis:!0},s({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(h.k,{justifyContent:"flex-end"},e.createElement(h.k,{maxWidth:(0,l.pxToRem)(250),justifyContent:"flex-end",title:a},e.createElement(b.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};g.propTypes={statusCode:E().number,message:E().string},g.defaultProps={statusCode:void 0,message:void 0};const T=({onCancel:n})=>{const{formatMessage:a}=(0,U.Z)();return e.createElement(h.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(h.k,{gap:2,alignItems:"center"},e.createElement(b.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(x,{as:N.Z,color:"neutral400"}))))};T.propTypes={onCancel:E().func.isRequired};const K=({isPending:n,onCancel:a,response:s})=>{const{statusCode:u,message:p}=s,{formatMessage:Z}=(0,U.Z)();return e.createElement(V.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(G.r,{gap:4,style:{alignItems:"center"}},e.createElement(S.P,{col:3},e.createElement(b.Z,null,Z({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(S.P,{col:3},e.createElement(v,{isPending:n,statusCode:u})),e.createElement(S.P,{col:6},n?e.createElement(T,{onCancel:a}):e.createElement(g,{statusCode:u,message:p}))))};K.defaultProps={isPending:!1,onCancel(){},response:{}},K.propTypes={isPending:E().bool,onCancel:E().func,response:E().object};const Ce=K;var ye=function(){return window&&window.strapi&&window.strapi.isEE?t(65224).Z:t(93016).Z}(),Ee=function(a){var s,u,p=a.handleSubmit,Z=a.triggerWebhook,m=a.isCreating,F=a.isTriggering,_=a.triggerResponse,r=a.data,$=(0,U.Z)(),L=$.formatMessage,q=(0,e.useState)(!1),re=(0,ee.Z)(q,2),he=re[0],oe=re[1],ve=function(ie){return Object.keys(ie).length?Object.entries(ie).map(function(pe){var O=(0,ee.Z)(pe,2),W=O[0],be=O[1];return{key:W,value:be}}):[{key:"",value:""}]},M=(0,A.useFormik)({initialValues:{name:r?.name||"",url:r?.url||"",headers:ve(r?.headers||{}),events:r?.events||[]},onSubmit:p,validationSchema:J({formatMessage:L}),validateOnChange:!1,validateOnBlur:!1});return e.createElement(A.FormikProvider,{value:M},e.createElement(l.Form,{onSubmit:M.handleSubmit},e.createElement(ne.T,{primaryAction:e.createElement(h.k,{gap:2},e.createElement(ae.z,{onClick:function(){Z(),oe(!0)},variant:"tertiary",startIcon:e.createElement(te.Z,null),disabled:m||F,size:"L"},L({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(ae.z,{startIcon:e.createElement(D.Z,null),type:"submit",size:"L",disabled:!M.dirty,loading:M.isSubmitting},L({id:"global.save",defaultMessage:"Save"}))),title:m?L({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):r?.name,navigationAction:e.createElement(l.Link,{startIcon:e.createElement(ce.Z,null),to:"/settings/webhooks"},L({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ue.D,null,e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:4},he&&e.createElement(Ce,{isPending:F,response:_,onCancel:function(){return oe(!1)}}),e.createElement(V.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(h.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(G.r,{gap:6},e.createElement(S.P,{col:6},e.createElement(A.Field,{as:j.o,name:"name",error:(M==null||(s=M.errors)===null||s===void 0?void 0:s.name)&&M.errors.name,label:L({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(S.P,{col:12},e.createElement(A.Field,{as:j.o,name:"url",error:(M==null||(u=M.errors)===null||u===void 0?void 0:u.url)&&M.errors.url,label:L({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(I,null),e.createElement(ye,null)))))))};Ee.propTypes={data:E().object,handleSubmit:E().func.isRequired,triggerWebhook:E().func.isRequired,isCreating:E().bool.isRequired,isTriggering:E().bool.isRequired,triggerResponse:E().object},Ee.defaultProps={data:void 0,triggerResponse:void 0};const Me=Ee,fe=n=>({...n,headers:n.headers.reduce((a,{key:s,value:u})=>(s!==""&&(a[s]=u),a),{})}),Pe=()=>{const{params:{id:n}}=(0,B.$B)("/settings/webhooks/:id"),a=n==="create",{replace:s}=(0,B.k6)(),u=(0,l.useNotification)(),{formatAPIError:p}=(0,l.useAPIErrorHandler)(),Z=(0,C.useQueryClient)(),{isLoading:m}=(0,w.G)(),{put:F,get:_,post:r}=(0,l.useFetchClient)(),{isLoading:$,data:L,error:q}=(0,C.useQuery)(["webhooks",n],async()=>{const{data:{data:O}}=await _(`/admin/webhooks/${n}`);return O},{enabled:!a});e.useEffect(()=>{q&&u({type:"warning",message:p(q)})},[q,u,p]);const{isLoading:re,data:he,isIdle:oe,mutate:ve}=(0,C.useMutation)(()=>r(`/admin/webhooks/${n}/trigger`)),M=()=>ve(null,{onError(O){u({type:"warning",message:p(O)})}}),le=(0,C.useMutation)(O=>r("/admin/webhooks",O)),ie=(0,C.useMutation)(({id:O,body:W})=>F(`/admin/webhooks/${O}`,W)),pe=async O=>{if(a){le.mutate(fe(O),{onSuccess({data:W}){u({type:"success",message:{id:"Settings.webhooks.created"}}),s(`/settings/webhooks/${W.data.id}`)},onError(W){u({type:"warning",message:p(W)})}});return}ie.mutate({id:n,body:fe(O)},{onSuccess(){Z.invalidateQueries(["webhooks",n]),u({type:"success",message:{id:"notification.form.success.fields"}})},onError(W){u({type:"warning",message:p(W)})}})};return $||m?e.createElement(l.LoadingIndicatorPage,null):e.createElement(c.o,null,e.createElement(l.SettingsPageTitle,{name:"Webhooks"}),e.createElement(Me,{data:L,handleSubmit:pe,triggerWebhook:M,isCreating:a,isTriggering:re,isTriggerIdle:oe,triggerResponse:he?.data.data}))}},3672:(H,f,t)=>{t.r(f),t.d(f,{default:()=>w});var e=t(53547),l=t(22551),c=t(87751),C=t(41128);const w=()=>e.createElement(l.CheckPagePermissions,{permissions:c.Z.settings.webhooks.create},e.createElement(C.Z,null))},42122:(H,f,t)=>{t.r(f),t.d(f,{default:()=>w});var e=t(53547),l=t(22551),c=t(87751),C=t(41128);const w=()=>e.createElement(l.CheckPagePermissions,{permissions:c.Z.settings.webhooks.update},e.createElement(C.Z,null))},65224:(H,f,t)=>{t.d(f,{Z:()=>C});var e=t(53547),l=t(84714);function c(){return e.createElement(l.Z.Root,null,e.createElement(l.Z.Headers,null),e.createElement(l.Z.Body,null))}const C=c},90608:(H,f,t)=>{t.d(f,{O:()=>l});var e=t(29178);const l=e.Wx}}]);
