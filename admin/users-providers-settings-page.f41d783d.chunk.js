(self.webpackChunkyuewu_dev=self.webpackChunkyuewu_dev||[]).push([[2282],{8971:(p,b,e)=>{"use strict";e.r(b),e.d(b,{ProvidersPage:()=>de,default:()=>Ue});var t=e(53547),l=e(22072),a=e(22551),s=e(18721),i=e.n(s),d=e(11700),n=e.n(d),c=e(14087),g=e(17034),h=e(185),u=e(53979),v=e(49066),F=e(38939),j=e(8060),A=e(79031),E=e(37909),B=e(75515),ee=e(63237),K=e(15234),G=e(12028),me=e(4585),V=e(88767),o=e(87561),y=e(89031);const te={id:(0,y.OB)("PopUpForm.Providers.redirectURL.front-end.label"),defaultMessage:"The redirect URL to your front-end app"},ae={id:"http://www.client-app.com",defaultMessage:"http://www.client-app.com"},X={id:(0,y.OB)("PopUpForm.Providers.enabled.description"),defaultMessage:"If disabled, users won't be able to use this provider."},I={id:(0,y.OB)("PopUpForm.Providers.enabled.label"),defaultMessage:"Enable"},ne={id:(0,y.OB)("PopUpForm.Providers.key.label"),defaultMessage:"Client ID"},re={id:(0,y.OB)("PopUpForm.Providers.redirectURL.label"),defaultMessage:"The redirect URL to add in your {provider} application configurations"},W={id:(0,y.OB)("PopUpForm.Providers.key.placeholder"),defaultMessage:"TEXT"},se={id:(0,y.OB)("PopUpForm.Providers.secret.label"),defaultMessage:"Client Secret"},Q={email:{form:[[{intlLabel:I,name:"enabled",type:"bool",description:X,size:6}]],schema:o.Ry().shape({enabled:o.Xg().required(a.translatedErrors.required)})},providers:{form:[[{intlLabel:I,name:"enabled",type:"bool",description:X,size:6,validations:{required:!0}}],[{intlLabel:ne,name:"key",type:"text",placeholder:W,size:12,validations:{required:!0}}],[{intlLabel:se,name:"secret",type:"text",placeholder:W,size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:ae,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:re,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(a.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()})})},providersWithSubdomain:{form:[[{intlLabel:I,name:"enabled",type:"bool",description:X,size:6,validations:{required:!0}}],[{intlLabel:ne,name:"key",type:"text",placeholder:W,size:12,validations:{required:!0}}],[{intlLabel:se,name:"secret",type:"text",placeholder:W,size:12,validations:{required:!0}}],[{intlLabel:{id:(0,y.OB)({id:"PopUpForm.Providers.jwksurl.label"}),defaultMessage:"JWKS URL"},name:"jwksurl",type:"text",placeholder:W,size:12,validations:{required:!1}}],[{intlLabel:{id:(0,y.OB)("PopUpForm.Providers.subdomain.label"),defaultMessage:"Host URI (Subdomain)"},name:"subdomain",type:"text",placeholder:{id:(0,y.OB)("PopUpForm.Providers.subdomain.placeholder"),defaultMessage:"my.subdomain.com"},size:12,validations:{required:!0}}],[{intlLabel:te,placeholder:ae,name:"callback",type:"text",size:12,validations:{required:!0}}],[{intlLabel:re,name:"noName",type:"text",validations:{},size:12,disabled:!0}]],schema:o.Ry().shape({enabled:o.Xg().required(a.translatedErrors.required),key:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()}),secret:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()}),subdomain:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()}),callback:o.Z_().when("enabled",{is:!0,then:o.Z_().required(a.translatedErrors.required),otherwise:o.Z_()})})}},ge=async m=>{try{const{get:P}=(0,a.getFetchClient)(),{data:O}=await P((0,y.Gc)("providers"));return O}catch{throw m({type:"warning",message:{id:"notification.error"}}),new Error("error")}},ve=m=>{const{put:P}=(0,a.getFetchClient)();return P((0,y.Gc)("providers"),m)};var fe=e(89734),pe=e.n(fe);const he=m=>pe()(Object.keys(m).reduce((P,O)=>{const{icon:T,enabled:x,subdomain:Z}=m[O],L=T==="envelope"?["fas","envelope"]:["fab",T];return Z!==void 0?P.push({name:O,icon:L,enabled:x,subdomain:Z}):P.push({name:O,icon:L,enabled:x}),P},[]),"name");var ie=e(81912),ye=e(42866),Ee=e(24969),oe=e(2407),be=e(59946),Pe=e(11047),Me=e(11276),xe=e(67819),Oe=e(36856),le=e(29728),Le=e(45697),r=e.n(Le),Te=e(69554),Be=e(20707),Ce=e(16364);const J=({description:m,disabled:P,intlLabel:O,error:T,name:x,onChange:Z,placeholder:L,providerToEditName:D,type:U,value:f})=>{const{formatMessage:C}=(0,l.Z)(),S=x==="noName"?`${window.strapi.backendURL}/api/connect/${D}/callback`:f,z=C({id:O.id,defaultMessage:O.defaultMessage},{provider:D,...O.values}),R=m?C({id:m.id,defaultMessage:m.defaultMessage},{provider:D,...m.values}):"";if(U==="bool")return t.createElement(Be.s,{"aria-label":x,checked:f,disabled:P,hint:R,label:z,name:x,offLabel:C({id:"app.components.ToggleCheckbox.off-label",defaultMessage:"Off"}),onLabel:C({id:"app.components.ToggleCheckbox.on-label",defaultMessage:"On"}),onChange:$=>{Z({target:{name:x,value:$.target.checked}})}});const k=L?C({id:L.id,defaultMessage:L.defaultMessage},{...L.values}):"",w=T?C({id:T,defaultMessage:T}):"";return t.createElement(Ce.o,{"aria-label":x,disabled:P,error:w,label:z,name:x,onChange:Z,placeholder:k,type:U,value:S})};J.defaultProps={description:null,disabled:!1,error:"",placeholder:null,value:""},J.propTypes={description:r().shape({id:r().string.isRequired,defaultMessage:r().string.isRequired,values:r().object}),disabled:r().bool,error:r().string,intlLabel:r().shape({id:r().string.isRequired,defaultMessage:r().string.isRequired,values:r().object}).isRequired,name:r().string.isRequired,onChange:r().func.isRequired,placeholder:r().shape({id:r().string.isRequired,defaultMessage:r().string.isRequired,values:r().object}),providerToEditName:r().string.isRequired,type:r().string.isRequired,value:r().oneOfType([r().bool,r().string])};const Re=J,Y=({headerBreadcrumbs:m,initialData:P,isSubmiting:O,layout:T,isOpen:x,onSubmit:Z,onToggle:L,providerToEditName:D})=>{const{formatMessage:U}=(0,l.Z)();return x?t.createElement(ye.P,{onClose:L,labelledBy:"title"},t.createElement(Ee.x,null,t.createElement(oe.O,{label:m.join(", ")},m.map(f=>t.createElement(oe.$,{key:f},f)))),t.createElement(Te.Formik,{onSubmit:f=>Z(f),initialValues:P,validationSchema:T.schema,validateOnChange:!1},({errors:f,handleChange:C,values:S})=>t.createElement(a.Form,null,t.createElement(be.f,null,t.createElement(Pe.k,{direction:"column",alignItems:"stretch",gap:1},t.createElement(Me.r,{gap:5},T.form.map(z=>z.map(R=>t.createElement(xe.P,{key:R.name,col:R.size,xs:12},t.createElement(Re,{...R,error:f[R.name],onChange:C,value:S[R.name],providerToEditName:D}))))))),t.createElement(Oe.m,{startActions:t.createElement(le.z,{variant:"tertiary",onClick:L,type:"button"},U({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:t.createElement(le.z,{type:"submit",loading:O},U({id:"global.save",defaultMessage:"Save"}))})))):null};Y.defaultProps={initialData:null,providerToEditName:null},Y.propTypes={headerBreadcrumbs:r().arrayOf(r().string).isRequired,initialData:r().object,layout:r().shape({form:r().arrayOf(r().array),schema:r().object}).isRequired,isOpen:r().bool.isRequired,isSubmiting:r().bool.isRequired,onSubmit:r().func.isRequired,onToggle:r().func.isRequired,providerToEditName:r().string};const Ze=Y,de=()=>{const{formatMessage:m}=(0,l.Z)();(0,a.useFocusWhenNavigate)();const{notifyStatus:P}=(0,c.G)(),O=(0,V.useQueryClient)(),{trackUsage:T}=(0,a.useTracking)(),x=(0,t.useRef)(T),[Z,L]=(0,t.useState)(!1),[D,U]=(0,t.useState)(!1),[f,C]=(0,t.useState)(null),S=(0,a.useNotification)(),{lockApp:z,unlockApp:R}=(0,a.useOverlayBlocker)(),k=(0,t.useMemo)(()=>({update:ie.Z.updateProviders}),[]),{isLoading:w,allowedActions:{canUpdate:$}}=(0,a.useRBAC)(k),{isLoading:Fe,data:N,isFetching:Ae}=(0,V.useQuery)("get-providers",()=>ge(S),{onSuccess(){P(m({id:(0,y.OB)("Providers.data.loaded"),defaultMessage:"Providers have been loaded"}))},initialData:{}}),je=Fe||Ae,De=(0,V.useMutation)(ve,{async onSuccess(){await O.invalidateQueries("get-providers"),S({type:"info",message:{id:(0,y.OB)("notification.success.submit")}}),x.current("didEditAuthenticationProvider"),U(!1),q(),R()},onError(){S({type:"warning",message:{id:"notification.error"}}),R(),U(!1)},refetchActive:!1}),H=(0,t.useMemo)(()=>he(N),[N]),Se=H.length,ue=(0,t.useMemo)(()=>{if(!f)return!1;const M=H.find(_=>_.name===f);return i()(M,"subdomain")},[H,f]),ze=m({id:(0,y.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"}),We=(0,t.useMemo)(()=>f==="email"?Q.email:ue?Q.providersWithSubdomain:Q.providers,[f,ue]),q=()=>{L(M=>!M)},ce=M=>{$&&(C(M.name),q())},$e=async M=>{U(!0),z(),x.current("willEditAuthenticationProvider");const _={...N,[f]:M};De.mutate({providers:_})};return t.createElement(g.A,null,t.createElement(a.SettingsPageTitle,{name:ze}),t.createElement(h.o,null,t.createElement(u.T,{title:m({id:(0,y.OB)("HeaderNav.link.providers"),defaultMessage:"Providers"})}),je||w?t.createElement(a.LoadingIndicatorPage,null):t.createElement(v.D,null,t.createElement(F.i,{colCount:3,rowCount:Se+1},t.createElement(j.h,null,t.createElement(A.Tr,null,t.createElement(E.Th,null,t.createElement(B.Z,{variant:"sigma",textColor:"neutral600"},m({id:"global.name",defaultMessage:"Name"}))),t.createElement(E.Th,null,t.createElement(B.Z,{variant:"sigma",textColor:"neutral600"},m({id:(0,y.OB)("Providers.status"),defaultMessage:"Status"}))),t.createElement(E.Th,null,t.createElement(B.Z,{variant:"sigma"},t.createElement(ee.T,null,m({id:"global.settings",defaultMessage:"Settings"})))))),t.createElement(K.p,null,H.map(M=>t.createElement(A.Tr,{key:M.name,...(0,a.onRowClick)({fn:()=>ce(M),condition:$})},t.createElement(E.Td,{width:"45%"},t.createElement(B.Z,{fontWeight:"semiBold",textColor:"neutral800"},M.name)),t.createElement(E.Td,{width:"65%"},t.createElement(B.Z,{textColor:M.enabled?"success600":"danger600","data-testid":`enable-${M.name}`},M.enabled?m({id:"global.enabled",defaultMessage:"Enabled"}):m({id:"global.disabled",defaultMessage:"Disabled"}))),t.createElement(E.Td,{...a.stopPropagation},$&&t.createElement(G.h,{onClick:()=>ce(M),noBorder:!0,icon:t.createElement(me.Z,null),label:"Edit"})))))))),t.createElement(Ze,{initialData:N[f],isOpen:Z,isSubmiting:D,layout:We,headerBreadcrumbs:[m({id:(0,y.OB)("PopUpForm.header.edit.providers"),defaultMessage:"Edit Provider"}),n()(f)],onToggle:q,onSubmit:$e,providerToEditName:f}))},Ue=()=>t.createElement(a.CheckPagePermissions,{permissions:ie.Z.readProviders},t.createElement(de,null))},89031:(p,b,e)=>{"use strict";e.d(b,{YX:()=>s,Gc:()=>n,OB:()=>c.Z});var t=e(41609),l=e.n(t);const s=g=>Object.keys(g).reduce((h,u)=>{const v=g[u].controllers,F=Object.keys(v).reduce((j,A)=>(l()(v[A])||(j[A]=v[A]),j),{});return l()(F)||(h[u]={controllers:F}),h},{});var i=e(31498);const n=g=>`/${i.Z}/${g}`;var c=e(84757)},89881:(p,b,e)=>{var t=e(47816),l=e(99291),a=l(t);p.exports=a},69199:(p,b,e)=>{var t=e(89881),l=e(98612);function a(s,i){var d=-1,n=l(s)?Array(s.length):[];return t(s,function(c,g,h){n[++d]=i(c,g,h)}),n}p.exports=a},82689:(p,b,e)=>{var t=e(29932),l=e(97786),a=e(67206),s=e(69199),i=e(71131),d=e(7518),n=e(85022),c=e(6557),g=e(1469);function h(u,v,F){v.length?v=t(v,function(E){return g(E)?function(B){return l(B,E.length===1?E[0]:E)}:E}):v=[c];var j=-1;v=t(v,d(a));var A=s(u,function(E,B,ee){var K=t(v,function(G){return G(E)});return{criteria:K,index:++j,value:E}});return i(A,function(E,B){return n(E,B,F)})}p.exports=h},71131:p=>{function b(e,t){var l=e.length;for(e.sort(t);l--;)e[l]=e[l].value;return e}p.exports=b},26393:(p,b,e)=>{var t=e(33448);function l(a,s){if(a!==s){var i=a!==void 0,d=a===null,n=a===a,c=t(a),g=s!==void 0,h=s===null,u=s===s,v=t(s);if(!h&&!v&&!c&&a>s||c&&g&&u&&!h&&!v||d&&g&&u||!i&&u||!n)return 1;if(!d&&!c&&!v&&a<s||v&&i&&n&&!d&&!c||h&&i&&n||!g&&n||!u)return-1}return 0}p.exports=l},85022:(p,b,e)=>{var t=e(26393);function l(a,s,i){for(var d=-1,n=a.criteria,c=s.criteria,g=n.length,h=i.length;++d<g;){var u=t(n[d],c[d]);if(u){if(d>=h)return u;var v=i[d];return u*(v=="desc"?-1:1)}}return a.index-s.index}p.exports=l},99291:(p,b,e)=>{var t=e(98612);function l(a,s){return function(i,d){if(i==null)return i;if(!t(i))return a(i,d);for(var n=i.length,c=s?n:-1,g=Object(i);(s?c--:++c<n)&&d(g[c],c,g)!==!1;);return i}}p.exports=l},89734:(p,b,e)=>{var t=e(21078),l=e(82689),a=e(5976),s=e(16612),i=a(function(d,n){if(d==null)return[];var c=n.length;return c>1&&s(d,n[0],n[1])?n=[]:c>2&&s(n[0],n[1],n[2])&&(n=[n[0]]),l(d,t(n,1),[])});p.exports=i},2407:(p,b,e)=>{"use strict";e.d(b,{$:()=>g,O:()=>h});var t=e(85893),l=e(16405),a=e(54863),s=e(63237),i=e(11047),d=e(41580),n=e(75515);const c=(0,a.default)(i.k)`
  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
    path {
      fill: ${({theme:u})=>u.colors.neutral500};
    }
  }
  :last-of-type ${d.x} {
    display: none;
  }
  :last-of-type ${n.Z} {
    color: ${({theme:u})=>u.colors.neutral800};
    font-weight: ${({theme:u})=>u.fontWeights.bold};
  }
`,g=({children:u})=>(0,t.jsxs)(c,{inline:!0,as:"li",children:[(0,t.jsx)(n.Z,{variant:"pi",textColor:"neutral600",children:u}),(0,t.jsx)(d.x,{"aria-hidden":!0,paddingLeft:3,paddingRight:3,children:(0,t.jsx)(l.Z,{})})]});g.displayName="Crumb";const h=({children:u,label:v,...F})=>(0,t.jsxs)(i.k,{...F,children:[(0,t.jsx)(s.T,{children:v}),(0,t.jsx)("ol",{"aria-hidden":!0,children:u})]});h.displayName="Breadcrumbs"}}]);
