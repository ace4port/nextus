"use strict";(self.webpackChunkyuewu_dev=self.webpackChunkyuewu_dev||[]).push([[2812],{50935:(B,y,t)=>{t.d(y,{R:()=>f});var e=t(88767),l=t(22551),g=t(80129);function f(T={},h={}){const{id:p="",...v}=T,L=(0,g.stringify)(v,{encode:!1}),{get:C}=(0,l.useFetchClient)(),{data:d,isError:s,isLoading:R,refetch:U}=(0,e.useQuery)(["users",p,v],async()=>{const{data:{data:D}}=await C(`/admin/users/${p}${L?`?${L}`:""}`);return D},h);let M=[];return p&&d?M=[d]:Array.isArray(d?.results)&&(M=d.results),{users:M,pagination:d?.pagination??null,isLoading:R,isError:s,refetch:U}}},94699:(B,y,t)=>{t.d(y,{Z:()=>C});var e=t(53547),l=t(45697),g=t.n(l),f=t(22072),T=t(41580),h=t(29728),p=t(89597),v=t(22551);const L=({displayedFilters:d})=>{const[s,R]=(0,e.useState)(!1),{formatMessage:U}=(0,f.Z)(),M=(0,e.useRef)(),D=()=>{R(S=>!S)};return e.createElement(e.Fragment,null,e.createElement(T.x,{paddingTop:1,paddingBottom:1},e.createElement(h.z,{variant:"tertiary",ref:M,startIcon:e.createElement(p.Z,null),onClick:D,size:"S"},U({id:"app.utils.filters",defaultMessage:"Filters"})),s&&e.createElement(v.FilterPopoverURLQuery,{displayedFilters:d,isVisible:s,onToggle:D,source:M})),e.createElement(v.FilterListURLQuery,{filtersSchema:d}))};L.propTypes={displayedFilters:g().arrayOf(g().shape({name:g().string.isRequired,metadatas:g().shape({label:g().string}),fieldSchema:g().shape({type:g().string})})).isRequired};const C=L},35915:(B,y,t)=>{t.r(y),t.d(y,{default:()=>fe});var e=t(53547),l=t(22551),g=t(87751),f=t(22072),T=t(17034),h=t(49066),p=t(41580),v=t(185),L=t(53979),C=t(36989),d=t(45697),s=t.n(d),R=t(15234),U=t(79031),M=t(37909),D=t(75515),S=t(11047),Y=t(12028),G=t(8934),X=t(23855);const j=()=>{const{formatDate:a}=(0,f.Z)();return c=>{const i=(0,X.Z)(c),u=a(i,{dateStyle:"long"}),n=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${u}, ${n}`}},K={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},F=a=>K[a]||a,x=({headers:a,rows:m,onOpenModal:c})=>{const{formatMessage:i}=(0,f.Z)(),u=j(),n=({type:r,value:o,model:E})=>r==="date"?u(o):r==="action"?i({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:F(o)},{model:E}):o||"-";return e.createElement(R.p,null,m.map(r=>e.createElement(U.Tr,{key:r.id,...(0,l.onRowClick)({fn:()=>c(r.id)})},a.map(({key:o,name:E,cellFormatter:O})=>e.createElement(M.Td,{key:o},e.createElement(D.Z,{textColor:"neutral800"},n({type:o,value:O?O(r[E]):r[E],model:r.payload?.model})))),e.createElement(M.Td,{...l.stopPropagation},e.createElement(S.k,{justifyContent:"end"},e.createElement(Y.h,{onClick:()=>c(r.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${r.action} action`}),noBorder:!0,icon:e.createElement(G.Z,null)}))))))};x.defaultProps={rows:[]},x.propTypes={headers:s().array.isRequired,rows:s().array,onOpenModal:s().func.isRequired};const w=x,k=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],$=({pagination:a})=>e.createElement(p.x,{paddingTop:4},e.createElement(S.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(l.PageSizeURLQuery,null),e.createElement(l.PaginationURLQuery,{pagination:a})));$.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},$.propTypes={pagination:s().shape({page:s().number,pageCount:s().number,pageSize:s().number,total:s().number})};const q=$;var N=t(88767),_=t(42866),ee=t(24969),V=t(2407),te=t(59946),ae=t(77197),se=t(11276),ne=t(89120);const Q=({actionLabel:a,actionName:m})=>e.createElement(S.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(D.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(D.Z,{textColor:"neutral600"},m));Q.propTypes={actionLabel:s().string.isRequired,actionName:s().string.isRequired};const I=Q,Z=({status:a,data:m,formattedDate:c})=>{const{formatMessage:i}=(0,f.Z)();if(a==="loading")return e.createElement(S.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(ae.a,null,"Loading content..."));const{action:u,user:n,payload:r}=m;return e.createElement(e.Fragment,null,e.createElement(p.x,{marginBottom:3},e.createElement(D.Z,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(se.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${u}`,defaultMessage:F(u)},{model:r?.model})}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:c}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:n?.displayName||"-"}),e.createElement(I,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:n?.id.toString()||"-"})),e.createElement(ne.V,{value:JSON.stringify(r,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};Z.defaultProps={data:{}},Z.propTypes={status:s().oneOf(["idle","loading","error","success"]).isRequired,data:s().shape({action:s().string,date:s().string,payload:s().object,user:s().object}),formattedDate:s().string.isRequired};const oe=Z,H=({handleClose:a,logId:m})=>{const{get:c}=(0,l.useFetchClient)(),i=(0,l.useNotification)(),u=async O=>{const{data:A}=await c(`/admin/audit-logs/${O}`);if(!A)throw new Error("Audit log not found");return A},{data:n,status:r}=(0,N.useQuery)(["audit-log",m],()=>u(m),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),o=j(),E=n?o(n.date):"";return e.createElement(_.P,{onClose:a,labelledBy:"title"},e.createElement(ee.x,null,e.createElement(V.O,{label:E,id:"title"},e.createElement(V.$,null,E))),e.createElement(te.f,null,e.createElement(oe,{status:r,data:n,formattedDate:E})))};H.propTypes={handleClose:s().func.isRequired,logId:s().string.isRequired};const ie=H;var re=t(94699),le=t(29178),de=t(90608);const W=({value:a,options:m,onChange:c})=>{const{formatMessage:i}=(0,f.Z)(),u=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(le.hQ,{"aria-label":u,value:a,onChange:c},m.map(({label:n,customValue:r})=>e.createElement(de.O,{key:r,value:r},n)))};W.defaultProps={value:null},W.propTypes={value:s().string,options:s().arrayOf(s().shape({label:s().string.isRequired,customValue:s().string.isRequired}).isRequired).isRequired,onChange:s().func.isRequired};const z=W,J=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],me=({formatMessage:a,users:m,canReadUsers:c})=>{const i=Object.keys(K).map(n=>({label:a({id:`Settings.permissions.auditLogs.${n}`,defaultMessage:F(n)},{model:void 0}),customValue:n})),u=[{name:"action",metadatas:{customOperators:J,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:i,customInput:z},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(c&&m){const n=o=>o.username?o.username:o.firstname&&o.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:o.firstname,lastname:o.lastname}):o.email,r=m.map(o=>({label:n(o),customValue:o.id.toString()}));return[...u,{name:"user",metadatas:{customOperators:J,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:r,customInput:z},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return u};var ue=t(16550),ce=t(50935);const ge=({canReadAuditLogs:a,canReadUsers:m})=>{const{get:c}=(0,l.useFetchClient)(),{search:i}=(0,ue.TH)(),u=(0,l.useNotification)(),n={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:P=>u({type:"warning",message:P.message})},{users:r,isError:o,isLoading:E}=(0,ce.R)({},{...n,enabled:m,staleTime:2*(1e3*60)}),{data:O,isLoading:A,isError:b}=(0,N.useQuery)(["auditLogs",i],async({queryKey:P})=>{const ye=P[1],{data:Le}=await c(`/admin/audit-logs${ye}`);return Le},{...n,enabled:a});return{auditLogs:O,users:r,isLoading:E||A,hasError:b||o}},pe={...g.Z.settings.auditLogs,readUsers:g.Z.settings.users.read},Ee=()=>{const{formatMessage:a}=(0,f.Z)(),{allowedActions:{canRead:m,canReadUsers:c}}=(0,l.useRBAC)(pe),[{query:i},u]=(0,l.useQueryParams)(),{auditLogs:n,users:r,isLoading:o,hasError:E}=ge({canReadAuditLogs:m,canReadUsers:c});(0,l.useFocusWhenNavigate)();const O=me({formatMessage:a,users:r,canReadUsers:c}),A=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),b=k.map(P=>({...P,metadatas:{...P.metadatas,label:a(P.metadatas.label)}}));return E?e.createElement(T.A,null,e.createElement(h.D,null,e.createElement(p.x,{paddingTop:8},e.createElement(l.AnErrorOccurred,null)))):e.createElement(v.o,{"aria-busy":o},e.createElement(l.SettingsPageTitle,{name:A}),e.createElement(L.T,{title:A,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(C.Z,{startActions:e.createElement(re.Z,{displayedFilters:O})}),e.createElement(h.D,{canRead:m},e.createElement(l.DynamicTable,{contentType:"Audit logs",headers:b,rows:n?.results||[],withBulkActions:!0,isLoading:o},e.createElement(w,{headers:b,rows:n?.results||[],onOpenModal:P=>u({id:P})})),e.createElement(q,{pagination:n?.pagination})),i?.id&&e.createElement(ie,{handleClose:()=>u({id:null},"remove"),logId:i.id}))},fe=()=>e.createElement(l.CheckPagePermissions,{permissions:g.Z.settings.auditLogs.main},e.createElement(Ee,null))},2407:(B,y,t)=>{t.d(y,{$:()=>L,O:()=>C});var e=t(85893),l=t(16405),g=t(54863),f=t(63237),T=t(11047),h=t(41580),p=t(75515);const v=(0,g.default)(T.k)`
  svg {
    height: ${10/16}rem;
    width: ${10/16}rem;
    path {
      fill: ${({theme:d})=>d.colors.neutral500};
    }
  }
  :last-of-type ${h.x} {
    display: none;
  }
  :last-of-type ${p.Z} {
    color: ${({theme:d})=>d.colors.neutral800};
    font-weight: ${({theme:d})=>d.fontWeights.bold};
  }
`,L=({children:d})=>(0,e.jsxs)(v,{inline:!0,as:"li",children:[(0,e.jsx)(p.Z,{variant:"pi",textColor:"neutral600",children:d}),(0,e.jsx)(h.x,{"aria-hidden":!0,paddingLeft:3,paddingRight:3,children:(0,e.jsx)(l.Z,{})})]});L.displayName="Crumb";const C=({children:d,label:s,...R})=>(0,e.jsxs)(T.k,{...R,children:[(0,e.jsx)(f.T,{children:s}),(0,e.jsx)("ol",{"aria-hidden":!0,children:d})]});C.displayName="Breadcrumbs"},90608:(B,y,t)=>{t.d(y,{O:()=>l});var e=t(29178);const l=e.Wx}}]);
