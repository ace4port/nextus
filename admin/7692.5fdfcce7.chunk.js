(self.webpackChunkyuewu_dev=self.webpackChunkyuewu_dev||[]).push([[7692],{76539:(h,g,t)=>{"use strict";t.d(g,{Z:()=>s});var e=t(53547),i=t(22072),n=t(45697),a=t.n(n),m=t(22551),r=t(85018),y=t(67109),v=t(53979),p=t(11047),C=t(29728),T=t(30815),f=t(95428);const A=({onRegenerate:R,idToRegenerate:D,backUrl:W,onError:z})=>{const{formatMessage:F}=(0,i.Z)(),[K,X]=(0,e.useState)(!1),{regenerateData:Y,isLoadingConfirmation:Q}=(0,f.rW)(W,D,R,z),$=async()=>{Y(),X(!1)};return e.createElement(e.Fragment,null,e.createElement(C.z,{startIcon:e.createElement(T.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>X(!0),name:"regenerate"},F({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),e.createElement(m.ConfirmDialog,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:e.createElement(T.Z,null),isConfirmButtonLoading:Q,isOpen:K,onToggleDialog:()=>X(!1),onConfirm:$,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};A.defaultProps={onRegenerate(){},onError:void 0},A.propTypes={onRegenerate:a().func,idToRegenerate:a().oneOfType([a().number,a().string]).isRequired,backUrl:a().string.isRequired,onError:a().func};const M=A,O=({title:R,token:D,setToken:W,canEditInputs:z,canRegenerate:F,isSubmitting:K,backUrl:X,regenerateUrl:Y,onErrorRegenerate:Q})=>{const{formatMessage:$}=(0,i.Z)(),J=ae=>{W({...D,accessKey:ae})};return e.createElement(v.T,{title:D?.name||$(R),primaryAction:z?e.createElement(p.k,{gap:2},F&&D?.id&&e.createElement(M,{backUrl:Y,onRegenerate:J,idToRegenerate:D?.id,onError:Q}),e.createElement(C.z,{disabled:K,loading:K,startIcon:e.createElement(r.Z,null),type:"submit",size:"S"},$({id:"global.save",defaultMessage:"Save"}))):F&&D?.id&&e.createElement(M,{onRegenerate:J,idToRegenerate:D?.id,backUrl:Y}),navigationAction:e.createElement(m.Link,{startIcon:e.createElement(y.Z,null),to:X},$({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};O.propTypes={token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().oneOfType([a().number,a().string]),name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string}),canEditInputs:a().bool.isRequired,canRegenerate:a().bool.isRequired,setToken:a().func.isRequired,isSubmitting:a().bool.isRequired,backUrl:a().string.isRequired,title:a().shape({id:a().string,label:a().string}).isRequired,regenerateUrl:a().string.isRequired,onErrorRegenerate:a().func},O.defaultProps={token:void 0,onErrorRegenerate:void 0};const s=O},60401:(h,g,t)=>{"use strict";t.d(g,{Z:()=>C});var e=t(53547),i=t(45697),n=t.n(i),a=t(22072),m=t(40619),r=t(82562),y=t(75515),v=t(75056);const p=({token:T,errors:f,values:A,onChange:M,isCreating:O})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(e.Fragment,null,e.createElement(m.P,{name:"lifespan",label:s({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:A.lifespan!==null?A.lifespan:"0",error:f.lifespan?s(f.lifespan?.id?f.lifespan:{id:f.lifespan,defaultMessage:f.lifespan}):null,onChange:R=>{M({target:{name:"lifespan",value:R}})},required:!0,disabled:!O,placeholder:"Select"},e.createElement(r.W,{value:"604800000"},s({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),e.createElement(r.W,{value:"2592000000"},s({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),e.createElement(r.W,{value:"7776000000"},s({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),e.createElement(r.W,{value:"0"},s({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),e.createElement(y.Z,{variant:"pi",textColor:"neutral600"},!O&&`${s({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,v.IX)(T?.createdAt,parseInt(A.lifespan,10))}`))};p.propTypes={errors:n().shape({lifespan:n().string}),onChange:n().func.isRequired,values:n().shape({lifespan:n().oneOfType([n().number,n().string])}).isRequired,isCreating:n().bool.isRequired,token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().string,name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string})},p.defaultProps={errors:{},token:{}};const C=p},24122:(h,g,t)=>{"use strict";t.d(g,{Z:()=>C});var e=t(53547),i=t(22072),n=t(22551),a=t(12028),m=t(65186),r=t(69427),y=t(45697),v=t.n(y);const p=({token:T,tokenType:f})=>{const{formatMessage:A}=(0,i.Z)(),M=(0,n.useNotification)(),{trackUsage:O}=(0,n.useTracking)(),{copy:s}=(0,n.useClipboard)(),R=D=>async()=>{await s(D)&&(O.current("didCopyTokenKey",{tokenType:f}),M({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return e.createElement(n.ContentBox,{endAction:T&&e.createElement("span",{style:{alignSelf:"start"}},e.createElement(a.h,{label:A({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:R(T),noBorder:!0,icon:e.createElement(m.Z,null),style:{padding:0,height:"1rem"}})),title:T||A({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:A(T?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:e.createElement(r.Z,null),iconBackground:"neutral100"})};p.defaultProps={token:null},p.propTypes={token:v().string,tokenType:v().string.isRequired};const C=p},40695:(h,g,t)=>{"use strict";t.d(g,{Z:()=>y});var e=t(53547),i=t(45697),n=t.n(i),a=t(22072),m=t(61467);const r=({errors:v,values:p,onChange:C,canEditInputs:T})=>{const{formatMessage:f}=(0,a.Z)();return e.createElement(m.g,{label:f({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:v.description?f(v.description?.id?v.description:{id:v.description,defaultMessage:v.description}):null,onChange:C,disabled:!T},p.description)};r.propTypes={errors:n().shape({description:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({description:n().string}).isRequired},r.defaultProps={errors:{}};const y=r},61053:(h,g,t)=>{"use strict";t.d(g,{Z:()=>y});var e=t(53547),i=t(45697),n=t.n(i),a=t(22072),m=t(16364);const r=({errors:v,values:p,onChange:C,canEditInputs:T})=>{const{formatMessage:f}=(0,a.Z)();return e.createElement(m.o,{name:"name",error:v.name?f(v.name?.id?v.name:{id:v.name,defaultMessage:v.name}):null,label:f({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:C,value:p.name,disabled:!T,required:!0})};r.propTypes={errors:n().shape({name:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({name:n().string}).isRequired},r.defaultProps={errors:{}};const y=r},31065:(h,g,t)=>{"use strict";t.d(g,{Z:()=>v});var e=t(53547),i=t(45697),n=t.n(i),a=t(22072),m=t(40619),r=t(82562);const y=({name:p,errors:C,values:T,onChange:f,canEditInputs:A,options:M,label:O})=>{const{formatMessage:s}=(0,a.Z)();return e.createElement(m.P,{name:p,label:s({id:O.id,defaultMessage:O.defaultMessage}),value:T&&T[p],error:C[p]?s(C[p]?.id?C[p]:{id:C[p],defaultMessage:C[p]}):null,onChange:f,placeholder:"Select",required:!0,disabled:!A},M&&M.map(({value:R,label:D})=>e.createElement(r.W,{key:R,value:R},s(D))))};y.propTypes={name:n().string,options:n().arrayOf(n().shape({label:n().shape({id:n().string,defaultMessage:n().string}),value:n().string})),errors:n().shape({type:n().string}),onChange:n().func.isRequired,canEditInputs:n().bool.isRequired,values:n().shape({type:n().string}).isRequired,label:n().shape({id:n().string,defaultMessage:n().string}).isRequired},y.defaultProps={name:"type",errors:{},options:[]};const v=y},47670:(h,g,t)=>{"use strict";t.d(g,{Z:()=>e,f:()=>i});const e="api-token",i="transfer-token"},57692:(h,g,t)=>{"use strict";t.d(g,{Z:()=>ze});var e=t(53547),i=t(22072),n=t(22551),a=t(185),m=t(49066),r=t(11047),y=t(69554),v=t(16550),p=t(88767),C=t(19631),T=t(75056),f=t(53979),A=t(29728),M=t(85018),O=t(45697),s=t.n(O);const R=({apiTokenName:o})=>{const{formatMessage:l}=(0,i.Z)();return(0,n.useFocusWhenNavigate)(),e.createElement(a.o,{"aria-busy":"true"},e.createElement(n.SettingsPageTitle,{name:"API Tokens"}),e.createElement(f.T,{primaryAction:e.createElement(A.z,{disabled:!0,startIcon:e.createElement(M.Z,null),type:"button",size:"L"},l({id:"global.save",defaultMessage:"Save"})),title:o||l({id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"})}),e.createElement(m.D,null,e.createElement(n.LoadingIndicatorPage,null)))};R.defaultProps={apiTokenName:null},R.propTypes={apiTokenName:s().string};const D=R;var W=t(87751);const z=(0,e.createContext)({}),F=({children:o,...l})=>e.createElement(z.Provider,{value:l},o),K=()=>(0,e.useContext)(z);F.propTypes={children:s().node.isRequired};const Y=(o,l=[])=>({...o,selectedAction:null,routes:[],selectedActions:[],data:(0,T.mk)(l)});var Q=t(18172),$=t(97019),J=t.n($);const ae={data:{},selectedActions:[]},fe=(o,l)=>(0,Q.default)(o,d=>{switch(l.type){case"ON_CHANGE":{d.selectedActions.includes(l.value)?J()(d.selectedActions,l.value):d.selectedActions.push(l.value);break}case"SELECT_ALL_IN_PERMISSION":{l.value.every(E=>d.selectedActions.includes(E.actionId))?l.value.forEach(E=>{J()(d.selectedActions,E.actionId)}):l.value.forEach(E=>{d.selectedActions.push(E.actionId)});break}case"SELECT_ALL_ACTIONS":{d.selectedActions=[...d.data.allActionsIds];break}case"ON_CHANGE_READ_ONLY":{const I=d.data.allActionsIds.filter(E=>E.includes("find")||E.includes("findOne"));d.selectedActions=[...I];break}case"UPDATE_PERMISSIONS_LAYOUT":{d.data=(0,T.mk)(l.value);break}case"UPDATE_ROUTES":{d.routes={...l.value};break}case"UPDATE_PERMISSIONS":{d.selectedActions=[...l.value];break}case"SET_SELECTED_ACTION":{d.selectedAction=l.value;break}default:return d}});var oe=t(11276),H=t(67819),Z=t(75515),b=t(41580),ye=t(48403),Te=t.n(ye),he=t(48734),ve=t(74756),Ae=t(63081),me=t(36213),Ce=t(78114),ee=t(54863);const Ee=ee.css`
  background: ${o=>o.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Pe=(0,ee.default)(b.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${o=>o.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${o=>o.isActive&&Ee}
  &:hover {
    ${Ee}
  }
`,Me=ee.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:o})=>o.colors.neutral150};
`,ie=({controllers:o,label:l,orderNumber:d,disabled:I,onExpanded:E,indexExpandendCollapsedContent:c})=>{const{value:{onChangeSelectAll:B,onChange:V,selectedActions:L,setSelectedAction:N,selectedAction:w}}=K(),[U,ne]=(0,e.useState)(!1),{formatMessage:_}=(0,i.Z)(),S=()=>{ne(x=>!x),E(d)};(0,e.useEffect)(()=>{c!==null&&c!==d&&U&&ne(!1)},[c,d,U]);const j=x=>x===w;return e.createElement(he.U,{expanded:U,onToggle:S,variant:d%2?"primary":"secondary"},e.createElement(ve.B,{title:Te()(l)}),e.createElement(Ae.v,null,o?.map(x=>{const se=x.actions.every(P=>L.includes(P.actionId)),ce=x.actions.some(P=>L.includes(P.actionId));return e.createElement(b.x,{key:`${l}.${x?.controller}`},e.createElement(r.k,{justifyContent:"space-between",alignItems:"center",padding:4},e.createElement(b.x,{paddingRight:4},e.createElement(Z.Z,{variant:"sigma",textColor:"neutral600"},x?.controller)),e.createElement(Me,null),e.createElement(b.x,{paddingLeft:4},e.createElement(me.X,{value:se,indeterminate:!se&&ce,onValueChange:()=>{B({target:{value:[...x.actions]}})},disabled:I},_({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(oe.r,{gap:4,padding:4},x?.actions&&x?.actions.map(P=>e.createElement(H.P,{col:6,key:P.actionId},e.createElement(Pe,{isActive:j(P.actionId),padding:2,hasRadius:!0},e.createElement(me.X,{value:L.includes(P.actionId),name:P.actionId,onValueChange:()=>{V({target:{value:P.actionId}})},disabled:I},P.action),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>N({target:{value:P.actionId}}),style:{display:"inline-flex",alignItems:"center"}},e.createElement(Ce.Z,null)))))))})))};ie.defaultProps={controllers:[],orderNumber:0,disabled:!1,onExpanded:()=>null,indexExpandendCollapsedContent:null},ie.propTypes={controllers:s().array,orderNumber:s().number,label:s().string.isRequired,disabled:s().bool,onExpanded:s().func,indexExpandendCollapsedContent:s().number};const Re=ie,re=({section:o,...l})=>{const[d,I]=(0,e.useState)(null),E=c=>I(c);return e.createElement(b.x,{padding:4,background:"neutral0"},o&&o.map((c,B)=>e.createElement(Re,{key:c.apiId,label:c.label,controllers:c.controllers,orderNumber:B,indexExpandendCollapsedContent:d,onExpanded:E,name:c.apiId,...l})))};re.defaultProps={section:null},re.propTypes={section:s().arrayOf(s().object)};const Oe=re;var Ie=t(35161),De=t.n(Ie),ke=t(13217),Se=t.n(ke);const xe=o=>{switch(o){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Le=(0,ee.default)(b.x)`
  margin: -1px;
  border-radius: ${({theme:o})=>o.spaces[1]} 0 0 ${({theme:o})=>o.spaces[1]};
`;function le({route:o}){const{formatMessage:l}=(0,i.Z)(),{method:d,handler:I,path:E}=o,c=E?Se()(E.split("/")):[],[B="",V=""]=I?I.split("."):[],L=xe(o.method);return e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h3"},l({id:"Settings.apiTokens.createPage.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,B),e.createElement(Z.Z,{variant:"delta",textColor:"primary600"},".",V)),e.createElement(r.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Le,{background:L.background,borderColor:L.border,padding:2},e.createElement(Z.Z,{fontWeight:"bold",textColor:L.text},d)),e.createElement(b.x,{paddingLeft:2,paddingRight:2},De()(c,N=>e.createElement(Z.Z,{key:N,textColor:N.includes(":")?"neutral600":"neutral900"},"/",N)))))}le.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},le.propTypes={route:s().shape({handler:s().string,method:s().string,path:s().string})};const Be=le,Ue=()=>{const{value:{selectedAction:o,routes:l}}=K(),{formatMessage:d}=(0,i.Z)(),I=o?.split(".")[0];return e.createElement(H.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},o?e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},l[I]?.map(E=>E.config.auth?.scope?.includes(o)||E.handler===o?e.createElement(Be,{key:E.handler,route:E}):null)):e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h3"},d({id:"Settings.apiTokens.createPage.permissions.header.title",defaultMessage:"Advanced settings"})),e.createElement(Z.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Ze=({...o})=>{const{value:{data:l}}=K(),{formatMessage:d}=(0,i.Z)();return e.createElement(oe.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(H.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(Z.Z,{variant:"delta",as:"h2"},d({id:"Settings.apiTokens.createPage.permissions.title",defaultMessage:"Permissions"})),e.createElement(Z.Z,{as:"p",textColor:"neutral600"},d({id:"Settings.apiTokens.createPage.permissions.description",defaultMessage:"Only actions bound by a route are listed below."}))),l?.permissions&&e.createElement(Oe,{section:l?.permissions,...o})),e.createElement(Ue,null))},Ne=(0,e.memo)(Ze);var We=t(60401),Ke=t(61053),be=t(40695),Fe=t(31065);const de=({errors:o,onChange:l,canEditInputs:d,isCreating:I,values:E,apiToken:c,onDispatch:B,setHasChangedPermissions:V})=>{const{formatMessage:L}=(0,i.Z)(),N=({target:{value:U}})=>{V(!1),U==="full-access"&&B({type:"SELECT_ALL_ACTIONS"}),U==="read-only"&&B({type:"ON_CHANGE_READ_ONLY"})},w=[{value:"read-only",label:{id:"Settings.tokens.types.read-only",defaultMessage:"Read-only"}},{value:"full-access",label:{id:"Settings.tokens.types.full-access",defaultMessage:"Full access"}},{value:"custom",label:{id:"Settings.tokens.types.custom",defaultMessage:"Custom"}}];return e.createElement(b.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(Z.Z,{variant:"delta",as:"h2"},L({id:"global.details",defaultMessage:"Details"})),e.createElement(oe.r,{gap:5},e.createElement(H.P,{key:"name",col:6,xs:12},e.createElement(Ke.Z,{errors:o,values:E,canEditInputs:d,onChange:l})),e.createElement(H.P,{key:"description",col:6,xs:12},e.createElement(be.Z,{errors:o,values:E,canEditInputs:d,onChange:l})),e.createElement(H.P,{key:"lifespan",col:6,xs:12},e.createElement(We.Z,{isCreating:I,errors:o,values:E,onChange:l,token:c})),e.createElement(H.P,{key:"type",col:6,xs:12},e.createElement(Fe.Z,{values:E,errors:o,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:U=>{N({target:{value:U}}),l({target:{name:"type",value:U}})},options:w,canEditInputs:d})))))};de.propTypes={errors:s().shape({name:s().string,description:s().string,lifespan:s().string,type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({name:s().string,description:s().string,lifespan:s().oneOfType([s().number,s().string]),type:s().string}).isRequired,isCreating:s().bool.isRequired,apiToken:s().shape({id:s().oneOfType([s().number,s().string]),type:s().string,lifespan:s().string,name:s().string,accessKey:s().string,permissions:s().array,description:s().string,createdAt:s().string}),onDispatch:s().func.isRequired,setHasChangedPermissions:s().func.isRequired},de.defaultProps={errors:{},apiToken:{}};const $e=de;var He=t(24122),Ve=t(76539),te=t(47670);const Ge="Name already taken",ze=()=>{(0,n.useFocusWhenNavigate)();const{formatMessage:o}=(0,i.Z)(),{lockApp:l,unlockApp:d}=(0,n.useOverlayBlocker)(),I=(0,n.useNotification)(),E=(0,v.k6)(),[c,B]=(0,e.useState)(E.location.state?.apiToken.accessKey?{...E.location.state.apiToken}:null),{trackUsage:V}=(0,n.useTracking)(),L=(0,e.useRef)(V),{setCurrentStep:N}=(0,n.useGuidedTour)(),{allowedActions:{canCreate:w,canUpdate:U,canRegenerate:ne}}=(0,n.useRBAC)(W.Z.settings["api-tokens"]),[_,S]=(0,e.useReducer)(fe,ae,u=>Y(u,{})),{params:{id:j}}=(0,v.$B)("/settings/api-tokens/:id"),{get:x,post:se,put:ce}=(0,n.useFetchClient)(),P=j==="create";(0,p.useQuery)("content-api-permissions",async()=>{const[u,G]=await Promise.all(["/admin/content-api/permissions","/admin/content-api/routes"].map(async q=>{const{data:k}=await x(q);return k.data}));S({type:"UPDATE_PERMISSIONS_LAYOUT",value:u}),S({type:"UPDATE_ROUTES",value:G}),c&&(c?.type==="read-only"&&S({type:"ON_CHANGE_READ_ONLY"}),c?.type==="full-access"&&S({type:"SELECT_ALL_ACTIONS"}),c?.type==="custom"&&S({type:"UPDATE_PERMISSIONS",value:c?.permissions}))},{onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),(0,e.useEffect)(()=>{L.current(P?"didAddTokenFromList":"didEditTokenFromList",{tokenType:te.Z})},[P]);const{status:Xe}=(0,p.useQuery)(["api-token",j],async()=>{const{data:{data:u}}=await x(`/admin/api-tokens/${j}`);return B({...u}),u?.type==="read-only"&&S({type:"ON_CHANGE_READ_ONLY"}),u?.type==="full-access"&&S({type:"SELECT_ALL_ACTIONS"}),u?.type==="custom"&&S({type:"UPDATE_PERMISSIONS",value:u?.permissions}),u},{enabled:!P&&!c,onError(){I({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}}),Ye=async(u,G)=>{L.current(P?"willCreateToken":"willEditToken",{tokenType:te.Z}),l();const q=u.lifespan&&parseInt(u.lifespan,10)&&u.lifespan!=="0"?parseInt(u.lifespan,10):null;try{const{data:{data:k}}=P?await se("/admin/api-tokens",{...u,lifespan:q,permissions:u.type==="custom"?_.selectedActions:null}):await ce(`/admin/api-tokens/${j}`,{name:u.name,description:u.description,type:u.type,permissions:u.type==="custom"?_.selectedActions:null});P&&(E.replace(`/settings/api-tokens/${k.id}`,{apiToken:k}),N("apiTokens.success")),d(),B({...k}),I({type:"success",message:o(P?{id:"notification.success.apitokencreated",defaultMessage:"API Token successfully created"}:{id:"notification.success.apitokenedited",defaultMessage:"API Token successfully edited"})}),L.current(P?"didCreateToken":"didEditToken",{type:c.type,tokenType:te.Z})}catch(k){const ge=(0,C.Iz)(k.response.data);G.setErrors(ge),k?.response?.data?.error?.message===Ge?I({type:"warning",message:k.response.data.message||"notification.error.tokennamenotunique"}):I({type:"warning",message:k?.response?.data?.message||"notification.error"}),d()}},[je,pe]=(0,e.useState)(!1),Qe={..._,onChange:({target:{value:u}})=>{pe(!0),S({type:"ON_CHANGE",value:u})},onChangeSelectAll:({target:{value:u}})=>{pe(!0),S({type:"SELECT_ALL_IN_PERMISSION",value:u})},setSelectedAction:({target:{value:u}})=>{S({type:"SET_SELECTED_ACTION",value:u})}},ue=U&&!P||w&&P;return!P&&!c&&Xe!=="success"?e.createElement(D,{apiTokenName:c?.name}):e.createElement(F,{value:Qe},e.createElement(a.o,null,e.createElement(n.SettingsPageTitle,{name:"API Tokens"}),e.createElement(y.Formik,{validationSchema:T.fK,validateOnChange:!1,initialValues:{name:c?.name||"",description:c?.description||"",type:c?.type,lifespan:c?.lifespan?c.lifespan.toString():c?.lifespan},enableReinitialize:!0,onSubmit:(u,G)=>Ye(u,G)},({errors:u,handleChange:G,isSubmitting:q,values:k,setFieldValue:ge})=>(je&&k?.type!=="custom"&&ge("type","custom"),e.createElement(n.Form,null,e.createElement(Ve.Z,{backUrl:"/settings/api-tokens",title:{id:"Settings.apiTokens.createPage.title",defaultMessage:"Create API Token"},token:c,setToken:B,canEditInputs:ue,canRegenerate:ne,isSubmitting:q,regenerateUrl:"/admin/api-tokens/"}),e.createElement(m.D,null,e.createElement(r.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(c?.name)&&e.createElement(He.Z,{token:c?.accessKey,tokenType:te.Z}),e.createElement($e,{errors:u,onChange:G,canEditInputs:ue,isCreating:P,values:k,apiToken:c,onDispatch:S,setHasChangedPermissions:pe}),e.createElement(Ne,{disabled:!ue||k?.type==="read-only"||k?.type==="full-access"}))))))))}},75056:(h,g,t)=>{"use strict";t.d(g,{IX:()=>m,fK:()=>p,mk:()=>T});var e=t(6406),i=t(77349),n=t(51991);const m=(f,A,M="en")=>{if(A&&typeof A=="number"){const O=A/24/60/60/1e3;return(0,e.Z)((0,i.Z)(new Date(f),O),"PPP",{locale:n[M]})}return"Unlimited"};var r=t(87561),y=t(22551);const p=r.Ry().shape({name:r.Z_(y.translatedErrors.string).max(100).required(y.translatedErrors.required),type:r.Z_(y.translatedErrors.string).oneOf(["read-only","full-access","custom"]).required(y.translatedErrors.required),description:r.Z_().nullable(),lifespan:r.Rx().integer().min(0).nullable().defined(y.translatedErrors.required)}),T=f=>{const A={allActionsIds:[],permissions:[]};return A.permissions=Object.keys(f).map(M=>({apiId:M,label:M.split("::")[1],controllers:Object.keys(f[M].controllers).map(O=>({controller:O,actions:f[M].controllers[O].map(s=>{const R=`${M}.${O}.${s}`;return M.includes("api::")&&A.allActionsIds.push(R),{action:s,actionId:R}}).flat()})).flat()})),A}},41848:h=>{function g(t,e,i,n){for(var a=t.length,m=i+(n?1:-1);n?m--:++m<a;)if(e(t[m],m,t))return m;return-1}h.exports=g},42118:(h,g,t)=>{var e=t(41848),i=t(62722),n=t(42351);function a(m,r,y){return r===r?n(m,r,y):e(m,i,y)}h.exports=a},74221:h=>{function g(t,e,i,n){for(var a=i-1,m=t.length;++a<m;)if(n(t[a],e))return a;return-1}h.exports=g},62722:h=>{function g(t){return t!==t}h.exports=g},65464:(h,g,t)=>{var e=t(29932),i=t(42118),n=t(74221),a=t(7518),m=t(278),r=Array.prototype,y=r.splice;function v(p,C,T,f){var A=f?n:i,M=-1,O=C.length,s=p;for(p===C&&(C=m(C)),T&&(s=e(p,a(T)));++M<O;)for(var R=0,D=C[M],W=T?T(D):D;(R=A(s,W,R,f))>-1;)s!==p&&y.call(s,R,1),y.call(p,R,1);return p}h.exports=v},42351:h=>{function g(t,e,i){for(var n=i-1,a=t.length;++n<a;)if(t[n]===e)return n;return-1}h.exports=g},97019:(h,g,t)=>{var e=t(5976),i=t(45604),n=e(i);h.exports=n},45604:(h,g,t)=>{var e=t(65464);function i(n,a){return n&&n.length&&a&&a.length?e(n,a):n}h.exports=i},13217:(h,g,t)=>{var e=t(14259);function i(n){var a=n==null?0:n.length;return a?e(n,1,a):[]}h.exports=i}}]);
