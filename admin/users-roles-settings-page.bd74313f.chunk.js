(self.webpackChunkyuewu_dev=self.webpackChunkyuewu_dev||[]).push([[8853],{20400:(h,R,t)=>{"use strict";t.r(R),t.d(R,{default:()=>St});var e=t(53547),d=t(16550),s=t(22551),o=t(31498),i=t(81912),C=t(14087),y=t(17034),v=t(185),D=t(53979),P=t(29728),M=t(36989),T=t(49066),$=t(38939),B=t(8060),U=t(79031),b=t(37909),A=t(75515),K=t(63237),N=t(96315),S=t(22072),w=t(88767),z=t(89031);const Le=async(n,r)=>{try{const{get:a}=(0,s.getFetchClient)(),{data:l}=await a((0,z.Gc)("roles"));return r("The roles have loaded successfully"),l}catch{throw n({type:"warning",message:{id:"notification.error"}}),new Error("error")}},xe=async(n,r)=>{try{const{del:a}=(0,s.getFetchClient)();await a(`${(0,z.Gc)("roles")}/${n}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var Me=t(45697),Z=t.n(Me),Se=t(15234),O=t(11047),re=t(12028),Ze=t(4585),Oe=t(20022);const ne=({sortedRoles:n,canDelete:r,permissions:a,setRoleToDelete:l,onDelete:m})=>{const{formatMessage:c}=(0,S.Z)(),{push:f}=(0,d.k6)(),[g,E]=m,p=u=>r&&!["public","authenticated"].includes(u.type),L=u=>{l(u),E(!g)},x=u=>{f(`/settings/${o.Z}/roles/${u}`)};return e.createElement(Se.p,null,n?.map(u=>e.createElement(U.Tr,{key:u.name,...(0,s.onRowClick)({fn:()=>x(u.id)})},e.createElement(b.Td,{width:"20%"},e.createElement(A.Z,null,u.name)),e.createElement(b.Td,{width:"50%"},e.createElement(A.Z,null,u.description)),e.createElement(b.Td,{width:"30%"},e.createElement(A.Z,null,`${u.nb_users} ${c({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(b.Td,null,e.createElement(O.k,{justifyContent:"end",...s.stopPropagation},e.createElement(s.CheckPermissions,{permissions:a.updateRole},e.createElement(re.h,{onClick:()=>x(u.id),noBorder:!0,icon:e.createElement(Ze.Z,null),label:c({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${u.name}`})})),p(u)&&e.createElement(s.CheckPermissions,{permissions:a.deleteRole},e.createElement(re.h,{onClick:()=>L(u.id),noBorder:!0,icon:e.createElement(Oe.Z,null),label:c({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${u.name}`})})))))))},ke=ne;ne.defaultProps={canDelete:!1},ne.propTypes={onDelete:Z().array.isRequired,permissions:Z().object.isRequired,setRoleToDelete:Z().func.isRequired,sortedRoles:Z().array.isRequired,canDelete:Z().bool};const Ue=()=>{const{trackUsage:n}=(0,s.useTracking)(),{formatMessage:r,locale:a}=(0,S.Z)(),{push:l}=(0,d.k6)(),m=(0,s.useNotification)(),{notifyStatus:c}=(0,C.G)(),[{query:f}]=(0,s.useQueryParams)(),g=f?._q||"",[E,p]=(0,e.useState)(!1),[L,x]=(0,e.useState)(!1),[u,j]=(0,e.useState)();(0,s.useFocusWhenNavigate)();const W=(0,w.useQueryClient)(),k=(0,e.useMemo)(()=>({create:i.Z.createRole,read:i.Z.readRoles,update:i.Z.updateRole,delete:i.Z.deleteRole}),[]),{isLoading:G,allowedActions:{canRead:F,canDelete:Y}}=(0,s.useRBAC)(k),{isLoading:Zt,data:{roles:Ae},isFetching:Ot}=(0,w.useQuery)("get-roles",()=>Le(m,c),{initialData:{},enabled:F}),{includes:Pe}=(0,s.useFilter)(a,{sensitivity:"base"}),Te=(0,s.useCollator)(a,{sensitivity:"base"}),De=Zt||Ot,kt=()=>{n("willCreateRole"),l(`/settings/${o.Z}/roles/new`)},Ut=()=>{p(!E)},Bt={roles:{id:(0,z.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,z.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Nt=r({id:"global.roles",defaultMessage:"Roles"}),Gt=(0,w.useMutation)(H=>xe(H,m),{async onSuccess(){await W.invalidateQueries("get-roles")}}),Ft=async()=>{x(!0),await Gt.mutateAsync(u),p(!E),x(!1)},te=(Ae||[]).filter(H=>Pe(H.name,g)||Pe(H.description,g)).sort((H,be)=>Te.compare(H.name,be.name)||Te.compare(H.description,be.description)),It=g&&!te.length?"search":"roles",$t=4,jt=(Ae?.length||0)+1;return e.createElement(y.A,null,e.createElement(s.SettingsPageTitle,{name:Nt}),e.createElement(v.o,{"aria-busy":De},e.createElement(D.T,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(s.CheckPermissions,{permissions:i.Z.createRole},e.createElement(P.z,{onClick:kt,startIcon:e.createElement(N.Z,null),size:"S"},r({id:(0,z.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(M.Z,{startActions:e.createElement(s.SearchURLQuery,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(T.D,null,!F&&e.createElement(s.NoPermissions,null),(De||G)&&e.createElement(s.LoadingIndicatorPage,null),F&&te&&te?.length?e.createElement($.i,{colCount:$t,rowCount:jt},e.createElement(B.h,null,e.createElement(U.Tr,null,e.createElement(b.Th,null,e.createElement(A.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.name",defaultMessage:"Name"}))),e.createElement(b.Th,null,e.createElement(A.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.description",defaultMessage:"Description"}))),e.createElement(b.Th,null,e.createElement(A.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.users",defaultMessage:"Users"}))),e.createElement(b.Th,null,e.createElement(K.T,null,r({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(ke,{sortedRoles:te,canDelete:Y,permissions:i.Z,setRoleToDelete:j,onDelete:[E,p]})):e.createElement(s.EmptyStateLayout,{content:Bt[It]})),e.createElement(s.ConfirmDialog,{isConfirmButtonLoading:L,onConfirm:Ft,onToggleDialog:Ut,isOpen:E})))},Be=()=>e.createElement(s.CheckPagePermissions,{permissions:i.Z.accessRoles},e.createElement(Ue,null));var oe=t(69554),I=t(41580),q=t(11276),V=t(67819),ie=t(16364),le=t(61467),ce=t(85018),Ne=t(67109),Q=t(84757),Ge=t(27361),J=t.n(Ge),Fe=t(41609),Ie=t.n(Fe),$e=t(82569),je=t.n($e);const de=(0,e.createContext)({}),ue=({children:n,value:r})=>e.createElement(de.Provider,{value:r},n),se=()=>(0,e.useContext)(de);ue.propTypes={children:Z().node.isRequired,value:Z().object.isRequired};var _=t(54863),We=t(35161),Ve=t.n(We),He=t(13217),we=t.n(He);const ze=n=>{switch(n){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Qe=(0,_.default)(I.x)`
  margin: -1px;
  border-radius: ${({theme:n})=>n.spaces[1]} 0 0 ${({theme:n})=>n.spaces[1]};
`;function ae({route:n}){const{formatMessage:r}=(0,S.Z)(),{method:a,handler:l,path:m}=n,c=m?we()(m.split("/")):[],[f="",g=""]=l?l.split("."):[],E=ze(n.method);return e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(A.Z,{variant:"delta",as:"h3"},r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,f),e.createElement(A.Z,{variant:"delta",textColor:"primary600"},".",g)),e.createElement(O.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Qe,{background:E.background,borderColor:E.border,padding:2},e.createElement(A.Z,{fontWeight:"bold",textColor:E.text},a)),e.createElement(I.x,{paddingLeft:2,paddingRight:2},Ve()(c,p=>e.createElement(A.Z,{key:p,textColor:p.includes(":")?"neutral600":"neutral900"},"/",p)))))}ae.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ae.propTypes={route:Z().shape({handler:Z().string,method:Z().string,path:Z().string})};const Xe=ae,Ye=()=>{const{formatMessage:n}=(0,S.Z)(),{selectedAction:r,routes:a}=se(),l=je()(r.split("."),"controllers"),m=J()(a,l[0]),c=l.slice(1).join("."),f=Ie()(m)?[]:m.filter(g=>g.handler.endsWith(c));return e.createElement(V.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},r?e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},f.map((g,E)=>e.createElement(Xe,{key:E,route:g}))):e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(A.Z,{variant:"delta",as:"h3"},n({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(A.Z,{as:"p",textColor:"neutral600"},n({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))};var Je=t(48734),Ke=t(74756),qe=t(63081),_e=t(11700),et=t.n(_e);function tt(n){switch(n){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return et()(n.replace("api::","").replace("plugin::",""))}}const nt=tt;var st=t(89734),me=t.n(st),ge=t(36213),at=t(78114);const pe=_.css`
  background: ${n=>n.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,rt=(0,_.default)(I.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${n=>n.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${n=>n.isActive&&pe}
  &:hover {
    ${pe}
  }
`,ot=_.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:n})=>n.colors.neutral150};
`,Ee=({subCategory:n})=>{const{formatMessage:r}=(0,S.Z)(),{onChange:a,onChangeSelectAll:l,onSelectedAction:m,selectedAction:c,modifiedData:f}=se(),g=(0,e.useMemo)(()=>J()(f,n.name,{}),[f,n]),E=(0,e.useMemo)(()=>Object.values(g).every(u=>u.enabled===!0),[g]),p=(0,e.useMemo)(()=>Object.values(g).some(u=>u.enabled===!0)&&!E,[g,E]),L=(0,e.useCallback)(({target:{name:u}})=>{l({target:{name:u,value:!E}})},[E,l]),x=(0,e.useCallback)(u=>c===u,[c]);return e.createElement(I.x,null,e.createElement(O.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(I.x,{paddingRight:4},e.createElement(A.Z,{variant:"sigma",textColor:"neutral600"},n.label)),e.createElement(ot,null),e.createElement(I.x,{paddingLeft:4},e.createElement(ge.X,{name:n.name,value:E,onValueChange:u=>L({target:{name:n.name,value:u}}),indeterminate:p},r({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(O.k,{paddingTop:6,paddingBottom:6},e.createElement(q.r,{gap:2,style:{flex:1}},n.actions.map(u=>{const j=`${u.name}.enabled`;return e.createElement(V.P,{col:6,key:u.name},e.createElement(rt,{isActive:x(u.name),padding:2,hasRadius:!0},e.createElement(ge.X,{value:J()(f,j,!1),name:j,onValueChange:W=>a({target:{name:j,value:W}})},u.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>m(u.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(at.Z,null))))}))))};Ee.propTypes={subCategory:Z().object.isRequired};const it=Ee,he=({name:n,permissions:r})=>{const a=(0,e.useMemo)(()=>me()(Object.values(r.controllers).reduce((l,m,c)=>{const f=`${n}.controllers.${Object.keys(r.controllers)[c]}`,g=me()(Object.keys(m).reduce((E,p)=>[...E,{...m[p],label:p,name:`${f}.${p}`}],[]),"label");return[...l,{actions:g,label:Object.keys(r.controllers)[c],name:f}]},[]),"label"),[n,r]);return e.createElement(I.x,{padding:6},a.map(l=>e.createElement(it,{key:l.name,subCategory:l})))};he.propTypes={name:Z().string.isRequired,permissions:Z().object.isRequired};const lt=he,ct=(n,r)=>{const a=Object.keys(r).sort().map(l=>({name:l,isOpen:!1}));return{...n,collapses:a}};var ee=t(18172);const dt={collapses:[]},ut=(n,r)=>(0,ee.default)(n,a=>{switch(r.type){case"TOGGLE_COLLAPSE":{a.collapses=n.collapses.map((l,m)=>m===r.index?{...l,isOpen:!l.isOpen}:{...l,isOpen:!1});break}default:return a}}),mt=()=>{const{modifiedData:n}=se(),{formatMessage:r}=(0,S.Z)(),[{collapses:a},l]=(0,e.useReducer)(ut,dt,c=>ct(c,n)),m=c=>l({type:"TOGGLE_COLLAPSE",index:c});return e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:1},a.map((c,f)=>e.createElement(Je.U,{expanded:c.isOpen,onToggle:()=>m(f),key:c.name,variant:f%2===0?"secondary":void 0},e.createElement(Ke.B,{title:nt(c.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:c.name}),variant:f%2?"primary":"secondary"}),e.createElement(qe.v,null,e.createElement(I.x,null,e.createElement(lt,{permissions:n[c.name],name:c.name}))))))};var gt=t(36968),fe=t.n(gt),pt=t(69572),Et=t.n(pt);const ht={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},ft=(n,r)=>(0,ee.default)(n,a=>{switch(r.type){case"ON_CHANGE":{const l=r.keys.length,m=r.keys[l-1]==="enabled";if(r.value&&m){const c=Et()(r.keys,l-1).join(".");a.selectedAction=c}fe()(a,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const l=["modifiedData",...r.keys],m=J()(n,l,{}),c=Object.keys(m).reduce((f,g)=>(f[g]={...m[g],enabled:r.value},f),{});fe()(a,l,c);break}case"ON_RESET":{a.modifiedData=n.initialData;break}case"ON_SUBMIT_SUCCEEDED":{a.initialData=n.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:l}=r;a.selectedAction=l===n.selectedAction?"":l;break}default:return a}}),yt=(n,r,a)=>({...n,initialData:r,modifiedData:r,routes:a}),ye=(0,e.forwardRef)(({permissions:n,routes:r},a)=>{const{formatMessage:l}=(0,S.Z)(),[m,c]=(0,e.useReducer)(ft,ht,L=>yt(L,n,r));(0,e.useImperativeHandle)(a,()=>({getPermissions(){return{permissions:m.modifiedData}},resetForm(){c({type:"ON_RESET"})},setFormAfterSubmit(){c({type:"ON_SUBMIT_SUCCEEDED"})}}));const p={...m,onChange:({target:{name:L,value:x}})=>c({type:"ON_CHANGE",keys:L.split("."),value:x==="empty__string_value"?"":x}),onChangeSelectAll:({target:{name:L,value:x}})=>c({type:"ON_CHANGE_SELECT_ALL",keys:L.split("."),value:x}),onSelectedAction:L=>c({type:"SELECT_ACTION",actionToSelect:L})};return e.createElement(ue,{value:p},e.createElement(q.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(V.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(A.Z,{variant:"delta",as:"h2"},l({id:(0,Q.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(A.Z,{as:"p",textColor:"neutral600"},l({id:(0,Q.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(mt,null))),e.createElement(Ye,null)))});ye.propTypes={permissions:Z().object.isRequired,routes:Z().object.isRequired};const Ce=(0,e.memo)(ye),Kt={isLoading:!0,modifiedData:{}},qt=(n,r)=>produce(n,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.modifiedData={};break}case"GET_DATA_SUCCEEDED":{a.isLoading=!1,a.modifiedData=r.data;break}case"GET_DATA_ERROR":{a.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{a.modifiedData=r.data;break}default:return a}}),_t=null,en=(n,r)=>{const{isLoading:a,allowedActions:l}=useRBAC(r),[{isLoading:m,modifiedData:c},f]=useReducer(reducer,initialState),g=useNotification(),E=useRef(!0),{get:p}=useFetchClient();useEffect(()=>(a||(async()=>{try{f({type:"GET_DATA"});const{data:u}=await p(getRequestURL(n));f({type:"GET_DATA_SUCCEEDED",data:u})}catch(u){E.current&&(f({type:"GET_DATA_ERROR"}),console.error(u),g({type:"warning",message:{id:"notification.error"}}))}})(),()=>{E.current=!1}),[a,n,p,g]);const L=useCallback(x=>{f({type:"ON_SUBMIT_SUCCEEDED",data:x})},[]);return{allowedActions:l,dispatchSubmitSucceeded:L,isLoading:m,isLoadingForPermissions:a,modifiedData:c}},tn=null,nn={roles:[],isLoading:!0},sn=(n,r)=>produce(n,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.roles=[];break}case"GET_DATA_SUCCEEDED":{a.roles=r.data,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),an=null,rn=(n=!0)=>{const[{roles:r,isLoading:a},l]=useReducer(reducer,initialState,()=>init(initialState,n)),m=useNotification(),c=useRef(!0),f=useFetchClient(),g=useCallback(async()=>{try{l({type:"GET_DATA"});const{data:{roles:E}}=await f.get(`/${pluginId}/roles`);l({type:"GET_DATA_SUCCEEDED",data:E})}catch(E){const p=get(E,["response","payload","message"],"An error occured");c.current&&(l({type:"GET_DATA_ERROR"}),p!=="Forbidden"&&m({type:"warning",message:p}))}},[f,m]);return useEffect(()=>(n&&g(),()=>{c.current=!1}),[n,g]),{roles:r,isLoading:a,getData:g}},on=null,Ct=(n,r)=>({...n,isLoading:r}),Re={permissions:{},routes:{},isLoading:!0},Rt=(n,r)=>(0,ee.default)(n,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.permissions={},a.routes={};break}case"GET_DATA_SUCCEEDED":{a.permissions=r.permissions,a.routes=r.routes,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),ve=(n=!0)=>{const r=(0,s.useNotification)(),[{permissions:a,routes:l,isLoading:m},c]=(0,e.useReducer)(Rt,Re,()=>Ct(Re,n)),f=(0,s.useFetchClient)(),g=(0,e.useCallback)(async()=>{try{c({type:"GET_DATA"});const[{permissions:E},{routes:p}]=await Promise.all([`/${o.Z}/permissions`,`/${o.Z}/routes`].map(async L=>(await f.get(L)).data));c({type:"GET_DATA_SUCCEEDED",permissions:(0,z.YX)(E),routes:p})}catch(E){const p=J()(E,["response","payload","message"],"An error occured");c({type:"GET_DATA_ERROR"}),p!=="Forbidden"&&r({type:"warning",message:p})}},[r]);return(0,e.useEffect)(()=>{n&&g()},[g,n]),{permissions:a,routes:l,getData:g,isLoading:m}},vt={role:{},isLoading:!0},At=(n,r)=>(0,ee.default)(n,a=>{switch(r.type){case"GET_DATA_SUCCEEDED":{a.role=r.role,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{a.role.name=r.name,a.role.description=r.description;break}default:return a}}),Pt=n=>{const[r,a]=(0,e.useReducer)(At,vt),l=(0,s.useNotification)(),m=(0,e.useRef)(null),{get:c}=(0,s.useFetchClient)();(0,e.useEffect)(()=>(m.current=!0,n?f(n):a({type:"GET_DATA_SUCCEEDED",role:{}}),()=>m.current=!1),[n]);const f=async E=>{try{const{data:{role:p}}=await c(`/${o.Z}/roles/${E}`);m.current&&a({type:"GET_DATA_SUCCEEDED",role:p})}catch(p){console.error(p),a({type:"GET_DATA_ERROR"}),l({type:"warning",message:{id:"notification.error"}})}},g=(0,e.useCallback)(E=>{a({type:"ON_SUBMIT_SUCCEEDED",...E})},[]);return{...r,onSubmitSucceeded:g}};var X=t(87561);const Tt=X.Ry().shape({name:X.Z_().required(s.translatedErrors.required),description:X.Z_().required(s.translatedErrors.required)}),Dt=()=>{const{formatMessage:n}=(0,S.Z)(),[r,a]=(0,e.useState)(!1),l=(0,s.useNotification)(),{lockApp:m,unlockApp:c}=(0,s.useOverlayBlocker)(),{params:{id:f}}=(0,d.$B)(`/settings/${o.Z}/roles/:id`),{isLoading:g,routes:E}=ve(),{role:p,onSubmitSucceeded:L,isLoading:x}=Pt(f),u=(0,e.useRef)(),{put:j}=(0,s.useFetchClient)(),W=async k=>{m(),a(!0);try{const G=u.current.getPermissions();await j(`/${o.Z}/roles/${f}`,{...k,...G,users:[]}),L({name:k.name,description:k.description}),l({type:"success",message:{id:(0,Q.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(G){console.error(G),l({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),c()};return x?e.createElement(s.LoadingIndicatorPage,null):e.createElement(v.o,null,e.createElement(s.SettingsPageTitle,{name:"Roles"}),e.createElement(oe.Formik,{enableReinitialize:!0,initialValues:{name:p.name,description:p.description},onSubmit:W,validationSchema:Tt},({handleSubmit:k,values:G,handleChange:F,errors:Y})=>e.createElement(s.Form,{noValidate:!0,onSubmit:k},e.createElement(D.T,{primaryAction:!g&&e.createElement(P.z,{disabled:p.code==="strapi-super-admin",type:"submit",loading:r,startIcon:e.createElement(ce.Z,null)},n({id:"global.save",defaultMessage:"Save"})),title:p.name,subtitle:p.description,navigationAction:e.createElement(s.Link,{startIcon:e.createElement(Ne.Z,null),to:"/settings/users-permissions/roles"},n({id:"global.back",defaultMessage:"Back"}))}),e.createElement(T.D,null,e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(I.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(A.Z,{variant:"delta",as:"h2"},n({id:(0,Q.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(q.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(ie.o,{name:"name",value:G.name||"",onChange:F,label:n({id:"global.name",defaultMessage:"Name"}),error:Y.name?n({id:Y.name,defaultMessage:"Invalid value"}):null})),e.createElement(V.P,{col:6},e.createElement(le.g,{id:"description",value:G.description||"",onChange:F,label:n({id:"global.description",defaultMessage:"Description"}),error:Y.description?n({id:Y.description,defaultMessage:"Invalid value"}):null}))))),!g&&e.createElement(Ce,{ref:u,permissions:p.permissions,routes:E}))))))},bt=()=>e.createElement(s.CheckPagePermissions,{permissions:i.Z.updateRole},e.createElement(Dt,null)),Lt=X.Ry().shape({name:X.Z_().required(s.translatedErrors.required),description:X.Z_().required(s.translatedErrors.required)}),xt=()=>{const{formatMessage:n}=(0,S.Z)(),[r,a]=(0,e.useState)(!1),l=(0,s.useNotification)(),{goBack:m}=(0,d.k6)(),{lockApp:c,unlockApp:f}=(0,s.useOverlayBlocker)(),{isLoading:g,permissions:E,routes:p}=ve(),{trackUsage:L}=(0,s.useTracking)(),x=(0,e.useRef)(),{post:u}=(0,s.useFetchClient)(),j=async W=>{c(),a(!0);try{const k=x.current.getPermissions();await u(`/${o.Z}/roles`,{...W,...k,users:[]}),L("didCreateRole"),l({type:"success",message:{id:(0,Q.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),m()}catch(k){console.error(k),l({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),f()};return e.createElement(v.o,null,e.createElement(s.SettingsPageTitle,{name:"Roles"}),e.createElement(oe.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:j,validationSchema:Lt},({handleSubmit:W,values:k,handleChange:G,errors:F})=>e.createElement(s.Form,{noValidate:!0,onSubmit:W},e.createElement(D.T,{primaryAction:!g&&e.createElement(P.z,{type:"submit",loading:r,startIcon:e.createElement(ce.Z,null)},n({id:"global.save",defaultMessage:"Save"})),title:n({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:n({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(T.D,null,e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(I.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(O.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(A.Z,{variant:"delta",as:"h2"},n({id:(0,Q.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(q.r,{gap:4},e.createElement(V.P,{col:6},e.createElement(ie.o,{name:"name",value:k.name||"",onChange:G,label:n({id:"global.name",defaultMessage:"Name"}),error:F.name?n({id:F.name,defaultMessage:"Invalid value"}):null})),e.createElement(V.P,{col:6},e.createElement(le.g,{id:"description",value:k.description||"",onChange:G,label:n({id:"global.description",defaultMessage:"Description"}),error:F.description?n({id:F.description,defaultMessage:"Invalid value"}):null}))))),!g&&e.createElement(Ce,{ref:x,permissions:E,routes:p}))))))},Mt=()=>e.createElement(s.CheckPagePermissions,{permissions:i.Z.createRole},e.createElement(xt,null)),St=()=>e.createElement(s.CheckPagePermissions,{permissions:i.Z.accessRoles},e.createElement(d.rs,null,e.createElement(d.AW,{path:`/settings/${o.Z}/roles/new`,component:Mt,exact:!0}),e.createElement(d.AW,{path:`/settings/${o.Z}/roles/:id`,component:bt,exact:!0}),e.createElement(d.AW,{path:`/settings/${o.Z}/roles`,component:Be,exact:!0}),e.createElement(d.AW,{path:"",component:s.AnErrorOccurred})))},89031:(h,R,t)=>{"use strict";t.d(R,{YX:()=>o,Gc:()=>y,OB:()=>v.Z});var e=t(41609),d=t.n(e);const o=D=>Object.keys(D).reduce((P,M)=>{const T=D[M].controllers,$=Object.keys(T).reduce((B,U)=>(d()(T[U])||(B[U]=T[U]),B),{});return d()($)||(P[M]={controllers:$}),P},{});var i=t(31498);const y=D=>`/${i.Z}/${D}`;var v=t(84757)},47443:(h,R,t)=>{var e=t(42118);function d(s,o){var i=s==null?0:s.length;return!!i&&e(s,o,0)>-1}h.exports=d},1196:h=>{function R(t,e,d){for(var s=-1,o=t==null?0:t.length;++s<o;)if(d(e,t[s]))return!0;return!1}h.exports=R},20731:(h,R,t)=>{var e=t(88668),d=t(47443),s=t(1196),o=t(29932),i=t(7518),C=t(74757),y=200;function v(D,P,M,T){var $=-1,B=d,U=!0,b=D.length,A=[],K=P.length;if(!b)return A;M&&(P=o(P,i(M))),T?(B=s,U=!1):P.length>=y&&(B=C,U=!1,P=new e(P));e:for(;++$<b;){var N=D[$],S=M==null?N:M(N);if(N=T||N!==0?N:0,U&&S===S){for(var w=K;w--;)if(P[w]===S)continue e;A.push(N)}else B(P,S,T)||A.push(N)}return A}h.exports=v},89881:(h,R,t)=>{var e=t(47816),d=t(99291),s=d(e);h.exports=s},41848:h=>{function R(t,e,d,s){for(var o=t.length,i=d+(s?1:-1);s?i--:++i<o;)if(e(t[i],i,t))return i;return-1}h.exports=R},42118:(h,R,t)=>{var e=t(41848),d=t(62722),s=t(42351);function o(i,C,y){return C===C?s(i,C,y):e(i,d,y)}h.exports=o},62722:h=>{function R(t){return t!==t}h.exports=R},69199:(h,R,t)=>{var e=t(89881),d=t(98612);function s(o,i){var C=-1,y=d(o)?Array(o.length):[];return e(o,function(v,D,P){y[++C]=i(v,D,P)}),y}h.exports=s},82689:(h,R,t)=>{var e=t(29932),d=t(97786),s=t(67206),o=t(69199),i=t(71131),C=t(7518),y=t(85022),v=t(6557),D=t(1469);function P(M,T,$){T.length?T=e(T,function(b){return D(b)?function(A){return d(A,b.length===1?b[0]:b)}:b}):T=[v];var B=-1;T=e(T,C(s));var U=o(M,function(b,A,K){var N=e(T,function(S){return S(b)});return{criteria:N,index:++B,value:b}});return i(U,function(b,A){return y(b,A,$)})}h.exports=P},71131:h=>{function R(t,e){var d=t.length;for(t.sort(e);d--;)t[d]=t[d].value;return t}h.exports=R},26393:(h,R,t)=>{var e=t(33448);function d(s,o){if(s!==o){var i=s!==void 0,C=s===null,y=s===s,v=e(s),D=o!==void 0,P=o===null,M=o===o,T=e(o);if(!P&&!T&&!v&&s>o||v&&D&&M&&!P&&!T||C&&D&&M||!i&&M||!y)return 1;if(!C&&!v&&!T&&s<o||T&&i&&y&&!C&&!v||P&&i&&y||!D&&y||!M)return-1}return 0}h.exports=d},85022:(h,R,t)=>{var e=t(26393);function d(s,o,i){for(var C=-1,y=s.criteria,v=o.criteria,D=y.length,P=i.length;++C<D;){var M=e(y[C],v[C]);if(M){if(C>=P)return M;var T=i[C];return M*(T=="desc"?-1:1)}}return s.index-o.index}h.exports=d},99291:(h,R,t)=>{var e=t(98612);function d(s,o){return function(i,C){if(i==null)return i;if(!e(i))return s(i,C);for(var y=i.length,v=o?y:-1,D=Object(i);(o?v--:++v<y)&&C(D[v],v,D)!==!1;);return i}}h.exports=d},42351:h=>{function R(t,e,d){for(var s=d-1,o=t.length;++s<o;)if(t[s]===e)return s;return-1}h.exports=R},35161:(h,R,t)=>{var e=t(29932),d=t(67206),s=t(69199),o=t(1469);function i(C,y){var v=o(C)?e:s;return v(C,d(y,3))}h.exports=i},89734:(h,R,t)=>{var e=t(21078),d=t(82689),s=t(5976),o=t(16612),i=s(function(C,y){if(C==null)return[];var v=y.length;return v>1&&o(C,y[0],y[1])?y=[]:v>2&&o(y[0],y[1],y[2])&&(y=[y[0]]),d(C,e(y,1),[])});h.exports=i},13217:(h,R,t)=>{var e=t(14259);function d(s){var o=s==null?0:s.length;return o?e(s,1,o):[]}h.exports=d},69572:(h,R,t)=>{var e=t(14259),d=t(40554);function s(o,i,C){return o&&o.length?(i=C||i===void 0?1:d(i),e(o,0,i<0?0:i)):[]}h.exports=s},82569:(h,R,t)=>{var e=t(20731),d=t(5976),s=t(29246),o=d(function(i,C){return s(i)?e(i,C):[]});h.exports=o}}]);
